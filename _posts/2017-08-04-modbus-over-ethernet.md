---
layout: post
title: Modbus через Ethernet
tags: [modbus, serial, ethernet]
---

Поделюсь наболевшим по поводу опроса устройств с протоколом Modbus через
преобразователи Serial-to-Ethernet. Об этом протоколе знает, пожалуй, любой
наладчик АСУ*, но всё же стоит напомнить о некоторой структуре пакета протокола.

![Regular Show](/assets/images/regular-show.png){:itemprop="image"}

Пакет можно разделить на две части. Первая часть, независимая от среды передачи,
называется PDU (Protocol Data Unit) и содержит в зависимости от направления
передачи либо параметры запроса, либо результат. Вторая часть -- это ADU
(Application Data Unit), которая включает в себя PDU. Для передачи данных по
последовательным каналам связи типа RS-232, RS-485 обычно используется ADU формата
Modbus RTU или Modbus ASCII, для TCP соединения соответсвенно Modbus TCP. И вот
здесь начинается путаница, когда данные передаются через преобразователи интерфейсов.

Добросовестные производители преобразователей Serial-to-Ethernet предоставляют
режим конвертирования на лету из одного ADU в другой. В этом случае программа,
опрашивающая подчиненное Modbus-совместимое устройство, может свободно отсылать
запросы в формате Modbus TCP, которые будут преобразованы в формат Modbus RTU и
будут корректно обработаны устройством.

В случае, когда преобразователь не поддерживает режим конвертироватия пакетов
Modbus, т.е. работает прозрачно, то опрашивающая программа должна в TCP соединение
отправлять пакеты уже в формате Modbus RTU. Но не все программы умеют это делать
и чаще всего они автоматически выбирают формат пакета в зависимости от типа соединения.
В таком случае приходится либо использовать другое устройство-преобразователь или
использовать виртуальный COM-порт. Получается еще один уровень преобразования,
который по-моему мнению усложняет систему и делает её менее надёжной.

Хотелось бы надеяться, что недобросовестные производители устройств-преобразователей
будут более ответственны и внедрят поддержку преобразования формата ADU. А производители
софта пойдут им навстречу и так же не забудут возможность указаня формата вручную.
